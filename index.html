<html>
  <head>
    <title>Home</title>
    <style>
      #wall {
        /* border: 2px solid black; */
        background-color: antiquewhite;
      }
    </style>
  </head>
  <body>
    <input id="wallWidth" placeholder="Wall Width" />
    <input id="wallHeight" placeholder="Wall Height" />
    <button id="setWall">Set Wall Dimensions</button>
    <hr />
    <input id="frameWidth" value="20" placeholder="Frame Width" />
    <input id="frameHeight" placeholder="Frame Height" />
    <button id="addFrame">Add Frame</button>
    <button id="removeFrame">Remove Frame</button>
    <button id="distributeFrames">Distribute Frames</button>
    <button id="equidistantFrames">Equidistant Frames</button>
    <hr />

    <canvas id="wall" width="1000" height="100"></canvas>
    <script>
      let frames = [];
      let canvas = document.getElementById("wall");
      let ctx = canvas.getContext("2d");
      let addFrameButton = document.getElementById("addFrame");
      let distributeFramesButton = document.getElementById("distributeFrames");
      let equidistantFramesButton = document.getElementById("equidistantFrames");

      const yLocation = canvas.height / 2;

      addFrameButton.addEventListener("click", addFrame);
      distributeFramesButton.addEventListener("click", distributeFrames);
      equidistantFramesButton.addEventListener("click", equidistantFrames);

      function equidistantFrames() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        let wallWidth = parseInt(canvas.width);

        let sortedFrames = frames.slice().sort((a, b) => a.x - b.x);

        let totalWidth = sortedFrames.reduce(
          (acc, frame) => acc + frame.width,
          0
        );
        let totalGap = wallWidth - totalWidth;
        let gapEvery = totalGap / (sortedFrames.length + 1);

        let currentX = gapEvery;
        sortedFrames.forEach((frame) => {
          frame.x = currentX;
          currentX += frame.width + gapEvery;
        });

        sortedFrames.forEach(drawFrame);
        drawDistances();
      }

      function distributeFrames() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        let wallWidth = parseInt(canvas.width);
        let frameCount = frames.length;
        let frameEvery = wallWidth / (frameCount + 1);

        let sortedFrames = frames.slice().sort((a, b) => a.x - b.x);
        sortedFrames.forEach((frame, index) => {
          frame.x = (index + 1) * frameEvery - frame.width / 2;
          frame.y = yLocation - frame.height / 2;
          console.log(frame.x, frame.y);
        });
        sortedFrames.forEach(drawFrame);

        drawDistances();
      }

      function drawDistances() {
        let sortedFrames = frames.slice().sort((a, b) => a.x - b.x);
        let distances = [];
        let currentX = 0;

        for (let i = 0; i < sortedFrames.length; i++) {
          distances.push({ x1: currentX, x2: sortedFrames[i].x });
          currentX = sortedFrames[i].x + sortedFrames[i].width;
        }
        if (currentX < canvas.width) {
          distances.push({ x1: currentX, x2: canvas.width });
        }

        distances.forEach((distance) => {
          ctx.strokeStyle = "black";
          ctx.beginPath();
          ctx.moveTo(distance.x1, yLocation);
          ctx.lineTo(distance.x2, yLocation);
          ctx.stroke();

          let distanceTwoDecimals = (distance.x2 - distance.x1).toFixed(2);
          ctx.font = "20px serif";
          let textWidth = ctx.measureText(distanceTwoDecimals).width;
          ctx.fillText(
            distanceTwoDecimals,
            distance.x1 + (distance.x2 - distance.x1) / 2 - textWidth / 2,
            50
          );
        });
      }

      function addFrame() {
        let frameWidth = parseInt(document.getElementById("frameWidth").value);
        let frameHeight = parseInt(
          document.getElementById("frameHeight").value
        );
        frameHeight = frameHeight || frameWidth;
        let frame = { width: frameWidth, height: frameHeight, x: 0, y: 0 };
        frames.push(frame);
        distributeFrames();
      }

      function drawFrame(frame) {
        ctx.strokeStyle = "black"; // or any color for the border
        ctx.fillStyle = "blue"; // or any color for the fill
        ctx.strokeRect(frame.x, frame.y, frame.width, frame.height);
      }

      let selectedFrame = null;

      canvas.addEventListener("mousedown", function (e) {
        let rect = canvas.getBoundingClientRect();
        let x = e.clientX - rect.left;
        let y = e.clientY - rect.top;
        selectedFrame = frames.find(
          (frame) =>
            x > frame.x &&
            x < frame.x + frame.width &&
            y > frame.y &&
            y < frame.y + frame.height
        );
      });

      canvas.addEventListener("mousemove", function (e) {
        if (selectedFrame) {
          let rect = canvas.getBoundingClientRect();
          selectedFrame.x = e.clientX - rect.left - selectedFrame.width / 2;
          // selectedFrame.y = e.clientY - rect.top - selectedFrame.height / 2;
          ctx.clearRect(0, 0, canvas.width, canvas.height);
          frames.forEach(drawFrame);

          drawDistances();
        }
      });

      canvas.addEventListener("mouseup", function (e) {
        selectedFrame = null;
      });
    </script>
  </body>
</html>
